{% extends 'base.html' %}
{% load static nofo_name input_type %}

{% block title %}
  Subsection: {% if subsection.name %}{{ subsection.name }}{% else %}(#{{ subsection.order }}){% endif %}
{% endblock %}

{% block css %}
  <link href="{% static 'plugins/css/bootstrap.min.css' %}" type="text/css" media="all" rel="stylesheet">
  <link href="{% static 'plugins/css/ace.min.css' %}" type="text/css" media="all" rel="stylesheet">
  <link href="{% static 'plugins/css/resizable.min.css' %}" type="text/css" media="all" rel="stylesheet">
  <link href="{% static 'martor/css/martor.bootstrap.min.css' %}" type="text/css" media="all" rel="stylesheet">
{% endblock %}

{% block body_class %}subsection_edit{% endblock %}

{% block content %}
  {% with nofo|nofo_name as nofo_name_str %}
    <div class="back-link font-body-md margin-bottom-105">
      <a href="{% url 'nofos:nofo_edit' nofo.id %}">‚Üê Edit ‚Äú{{ nofo_name_str }}‚Äù</a>
    </div>
    <div class="subsection_edit--header">
      <h1 class="font-heading-xl margin-y-0">Subsection: {% if subsection.name %}{{ subsection.name }}{% else %}(#{{ subsection.order }}){% endif %}</h1>
      {% if subsection.callout_box %}<h2 class="font-heading-lg margin-y-1 text-base"><span aria-hidden="true">üì¶</span> Callout box</h2>{% endif %}
      {% if request.user.is_superuser %}
        <div class="subsection_edit--header--view font-sans-md">
          <a href="{% url 'admin:nofos_subsection_change' subsection.id %}">Edit in Admin</a>
        </div>
      {% endif %}
    </div>
  {% endwith %}
  
  <p>Edit page for this subsection.</p>

  <form class="form" method="post">
    {% csrf_token %}
    <fieldset>

      {% if form.non_field_errors %}
        <legend class="legend--bootstrap">
          <div class="usa-error-message">
            Error: {{ form.non_field_errors.0 }}
          </div>
        </legend>
      {% endif %}

      <input type="hidden" name="{{ form.tag.name }}" id="{{ form.tag.id_for_label }}" value="{{ subsection.tag }}">
      <input type="hidden" name="{{ form.callout_box.name }}" id="{{ form.callout_box.id_for_label }}" value="{{ subsection.callout_box }}">

      <div class="form-group">
        {% with id="name" label=form.name.label value=form.name.value hint=form.name.help_text error=form.name.errors.0 input_type=form.name|input_type %}
          {% if subsection.tag %}
            {% include "includes/_text_input.html" with id=id label=label hint="Heading level: "|add:subsection.tag value=value error=error input_type=input_type only %}
            {% if subsection.html_id %}
            <div class="usa-hint margin-top-05 hint--subsection-id" id="{{ id }}--hint-2">
              <span id="subsection-html_id">{{ "#"|add:subsection.html_id  }}</span>
              <button type="button" class="usa-button usa-button--outline" id="subsection-html_id--button">
                Copy
              </button>
            </div>

            <script>
              let text = document.getElementById('subsection-html_id').innerHTML;
              let button = document.getElementById('subsection-html_id--button');

              const copyContent = async () => {
                try {

                  await navigator.clipboard.writeText(text);
                  button.innerHTML = 'Copied!'
                  setTimeout(() => {
                    button.innerHTML = 'Copy'
                  }, "1000");

                } catch (err) {
                  console.error('Content failed to copy: ', err);
                }
              }

              button.addEventListener(
                "click",
                copyContent
              );
            </script>
            {% endif %}
          {% else %}
            {% include "includes/_text_input.html" with id=id label=label hint=hint value=value error=error input_type=input_type only %}
          {% endif %}
        {% endwith %}
      </div>
      <div class="form-group">
        <fieldset class="usa-fieldset">
          <legend class="usa-legend legend--bootstrap">Page break or column break</legend>
          {% if form.html_class.value %}
            {% if form.html_class.value != 'page-break-before' and form.html_class.value != 'column-break-before' and form.html_class.value != 'avoid-break--heading' %}
              <div class="padding-05 padding-left-1 border-solid border-top-width-0 border-bottom-width-0 border-right-width-0 border-left-width-05 border-accent-warm-dark text-accent-warm-dark">
                <span aria-hidden="true">‚ö†Ô∏è</span> Warning! This heading‚Äôs class is ‚Äò{{ form.html_class.value }}‚Äô. If you select a value, the existing class will be overwritten.
              </div>
            {% endif %}
          {% endif %}
          <div class="usa-radio">
            <input
            class="usa-radio__input"
              id="page-break-before"
              type="radio"
              name="html_class"
              value="page-break-before"
              {% if form.html_class.value and "page-break-before" in form.html_class.value %}
                checked="checked"
              {% endif %}
            />
            <label class="usa-radio__label" for="page-break-before">
              Has page break
            </label>
          </div>
          {% if 'landscape' in nofo.theme %}
            <div class="usa-radio">
              <input
              class="usa-radio__input"
                id="column-break-before"
                type="radio"
                name="html_class"
                value="column-break-before"
                {% if form.html_class.value and "column-break-before" in form.html_class.value %}
                  checked="checked"
                {% endif %}
              />
              <label class="usa-radio__label" for="column-break-before">
                Has column break
              </label>
            </div>
            <div class="usa-radio">
              <input
              class="usa-radio__input"
                id="avoid-break--heading"
                type="radio"
                name="html_class"
                value="avoid-break--heading"
                {% if form.html_class.value and "avoid-break--heading" in form.html_class.value %}
                  checked="checked"
                {% endif %}
              />
              <label class="usa-radio__label" for="avoid-break--heading">
                Avoid column break
              </label>
            </div>
          {% endif %}
          <div class="usa-radio">
            <input
            class="usa-radio__input"
              id="none"
              type="radio"
              name="html_class"
              value="none"
              {% if not form.html_class.value %}
                checked="checked"
              {% endif %}
            />
            <label class="usa-radio__label" for="none">
              None
            </label>
          </div>
      </div>
      <div class="form-group">
        <div class="border-2px border-base-lighter margin-top-4 radius-md">
          <label class="usa-label usa-sr-only" for="{{ form.body.id_for_label }}">Subsection content</label>
          {{ form.body }}
        </div>
      </div>
    </fieldset>
    <div class="form-group">
      <button class="usa-button margin-top-3" type="submit">Save subsection</button>
    </div>
  </form>

  <hr class="margin-top-3 margin-bottom-5" />
  <div>
    <h2 class="font-heading-lg">Other actions</h2>
    <p>
      <a class="usa-button usa-button--secondary" href="{% url 'nofos:subsection_delete' nofo.id subsection.id %}">
        Delete this subsection
      </a>
    </p>
  </div>
{% endblock %}

{% block js_footer %}
  <script type="text/javascript" src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/jquery.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/bootstrap.min.js' %}"></script>

  <script type="text/javascript" src="{% static 'plugins/js/ace.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/mode-markdown.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/ext-language_tools.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/theme-github.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/typo.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/spellcheck.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/highlight.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/resizable.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/emojis.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'martor/js/martor.bootstrap.min.js' %}"></script>
{% endblock %}
