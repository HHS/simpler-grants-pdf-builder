{% extends 'base.html' %}
{% load nofo_name %}

{% block title %}
  NOFO comparison result
{% endblock %}

{% block body_class %}nofo_compare{% endblock %}

  {% block content %}
  <div class="usa-alert usa-alert--info usa-alert--slim usa-alert--no-icon usa-alert--alpha margin-bottom-3">
    <div class="usa-alert__body bg-base-lightest">
      <p class="usa-alert__text">
        <span class="usa-tag bg-ink">Alpha</span>
        <span class="margin-left-1">Comparing NOFOs is an experimental feature and will change as we improve it.</span>
      </p>
    </div>
  </div>

  {% with nofo|nofo_name as nofo_name_str %}
    {% with "Compare a NOFO to “"|add:nofo_name_str|add:"”" as back_text %}
      {% url 'nofos:nofo_edit' nofo.id as back_href %}
      {% include "includes/page_heading.html" with title="NOFO comparison result" back_text=back_text back_href=back_href only %}
    {% endwith %}
  {% endwith %}

  {% if nofo_comparison %}
      <p>
        There are <strong>{{ num_changed_subsections }}</strong> subsection{{ num_changed_subsections|pluralize }} with changes in {{ num_changed_sections }} section{{ num_changed_sections|pluralize }}.
      </p>

      {% for section in nofo_comparison %}
        <table class="usa-table usa-table--borderless">
          <caption>
            <h2>{{ section.name }}</h2>
          </caption>
          <thead>
            <tr>
              <th scope="col">Subsection</th>
              <th scope="col">Status</th>
              <th scope="col">Content</th>
            </tr>
          </thead>
          <tbody>
            {% for subsection in section.subsections %}
            {% if subsection.status != 'MATCH' %}
              <tr>
                <th scope="row">
                  {{ subsection.name }}
                </th>
                <td>
                  {{ subsection.status }}
                </td>
                <td><div class="diff">{{ subsection.diff|safe }}</div></td>
              </tr>
            {% endif %}
            {% endfor %}
          </tbody>
        </table>
      {% endfor %}
  {% endif %}
  
{% endblock %}
