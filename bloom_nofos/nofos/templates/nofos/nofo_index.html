{% extends 'base.html' %}
{% load tz %}

{% block title %}
	All NOFOs
{% endblock %}

{% block body_class %}nofo_index{% endblock %}

{% block content %}
	{% include "includes/alerts.html" with messages=messages success_heading="NOFO imported successfully" error_heading="NOFO deleted" only %}

	<h1 class="font-heading-xl margin-y-0">All{% if nofo_status and nofo_status != 'all' %} {{ nofo_status }}{% endif %} NOFOs</h1>

	<p class="nofo_index--filter">
		<a href="{% url 'nofos:nofo_index' %}?status=all" {% if nofo_status == 'all' %}aria-current="page"{% endif %}>All NOFOs</a> | 
		<a href="{% url 'nofos:nofo_index' %}" {% if not nofo_status or nofo_status == 'unpublished' %}aria-current="page"{% endif %}>All unpublished NOFOs</a> | 
		<a href="{% url 'nofos:nofo_index' %}?status=published" {% if nofo_status == 'published' %}aria-current="page"{% endif %}>All published NOFOs</a>
	</p>

	{% if nofo_list %}
		<table class="sortable usa-table usa-table--borderless width-full">
			<caption>
				{% if not nofo_status or nofo_status == 'unpublished' %}
					NOFOs being worked on or in review.
				{% elif nofo_status == 'published' %}
					NOFOs that made it across the finish line.
				{% elif nofo_status == 'all' %}
					All the NOFOs fit to show.
				{% else %}
					List of NOFOs with status: {{ nofo_status }}
				{% endif %}
			</caption>
			<thead>
				<tr>
					<th scope="col" tabindex="0">Name</th>
					<th scope="col" tabindex="0">Number</th>
					{% if user.group == 'bloom' %}
						<th scope="col" class="nofo-group-col" tabindex="0">Group</th>
					{% endif %}
					<th scope="col" tabindex="0">Status</th>
					<th scope="col" tabindex="0">Coach</th>
					<th scope="col" tabindex="0">Designer</th>
					<th scope="col" tabindex="0">Updated</th>
					<th class="usa-sr-only" scope="col">Preview</th>
				</tr>
			</thead>
			<tbody>
				{% for nofo in nofo_list %}
					<tr {% if nofo.status == 'ready_for_adam' %}class="ready_for_adam"{% endif %}>
						<th scope="row"><a href="{% url 'nofos:nofo_edit' nofo.id %}">{% if nofo.short_name %}{{ nofo.short_name }}{% else %}{{ nofo.title }}{% endif %}</a></th>
						<td>{% if nofo.number %}{{ nofo.number }}{% else %}—{% endif %}</td>
						{% if user.group == 'bloom' %}
							<td>
								<span class="usa-tag bg-group bg-group--{{ nofo.group }}">{{ nofo.group }}</span>
							</td>
						{% endif %}
						<td>{{ nofo.get_status_display }}</td>
						<td>{% if nofo.coach %}{{ nofo.get_coach_display }}{% else %}<span class="usa-sr-only">No coach assigned</span><span aria-hidden="true">—</span>{% endif %}</td>
						<td>{% if nofo.designer %}{{ nofo.get_designer_display }}{% else %}<span class="usa-sr-only">No designer assigned</span><span aria-hidden="true">—</span>{% endif %}</td>
						{% timezone "America/New_York" %}
							<td data-sort="{{ nofo.updated|date:"YmdHM" }}">{{ nofo.updated|date:'M j' }}{% if nofo.updated|date:'M j' == today_m_j %}, {{ nofo.updated|date:'H:i' }}{% endif %}</td>
						{% endtimezone %}
						<td><a href="{% url 'nofos:nofo_view' nofo.id %}">View<span class="usa-sr-only"> {% if nofo.short_name %}{{ nofo.short_name }}{% else %}{{ nofo.title }}{% endif %}</span></a></td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	{% else %}
		<p>No Fos are available{% if nofo_status %} that are “{{ nofo_status }}”{% endif %}.</p>
	{% endif %}
	<h2 class="font-heading-md margin-top-6">Import a new NOFO</h2>
	<p>Upload your NOFO file as a Word Document or an HTML file exported from Google Docs.</p>
	<p>
		<a class="usa-button" href="{% url 'nofos:nofo_import' %}">
    Import NOFO
		</a>
	</p>
{% endblock %}

{% block js_footer %}
<script src="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@3/sortable.min.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', function() {
    // Select all table headers in the nofo index
    const headers = document.querySelectorAll('.nofo_index table.usa-table.sortable thead th');

		headers.forEach(function(header) {
        header.addEventListener('keydown', function(event) {
            // Check if the Enter key (key code 13) is pressed
            if (event.key === 'Enter') {
                event.preventDefault();
                header.click(); // Simulate a click on the header
            }
        });
    });
	});
</script>
{% endblock %}