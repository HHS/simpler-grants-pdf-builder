{% extends 'base_barebones.html' %}
{% load static martortags nofo_section_name_separator add_captions_to_tables %}

{% block css %}
  {% with "theme-"|add:nofo.theme|add:'.css' as filename %}
    <link href="{% static filename %}" type="text/css" media="all" rel="stylesheet" />
  {% endwith %}
{% endblock %}

{% block title %}
 View: {% if nofo.short_name %}{{ nofo.short_name }}{% else %}{{ nofo.title }}{% endif %}
{% endblock %}

{% block body_class %}{{ nofo.theme }}{% endblock %}

{% block header %}
  <header class="usa-header usa-header--basic">
    <div class="usa-nav-container">
      <div class="usa-navbar">
        <div class="usa-logo">
          <em class="usa-logo__text">
            <a href="{% url 'nofos:nofo_index' %}" class="usa-nav-link">‚Üê All NOFOs</a>
          </em>
        </div>
      </div>
      <nav aria-label="Primary navigation" class="usa-nav">
        <ul class="usa-nav__primary usa-accordion">
          <li class="usa-nav__primary-item">
            <a href="{% url 'nofos:nofo_edit' nofo.id %}" class="usa-nav-link">Edit this NOFO</a>
          </li>
        </ul>
      </nav>
    </div>
  </header>
{% endblock %}

{% block content %}
  <!-- TITLE PAGE -->
  <section class="title-page nofo--title-page">
    <div class="nofo--title-page--header clearfix">
      <div class="nofo--title-page--header--logo">
        <img alt="HRSA Health Workforce logo" src="https://bn-ptzepiewjq-uc.a.run.app/static/img/hrsa-logo.png" />
      </div>
      <div class="nofo--title-page--header--logo--subheading">
        <p>HRSA Health workforce</p>
      </div>
      <div class="nofo--title-page--header--intro">
        <span>Notice of Funding Opportunity</span>
        <br />
        <span>Opportunity number: {{ nofo.number }}</span>
      </div>
    </div>
    <div class="nofo--title-page--title">
      <h1 class="font-heading-xl margin-y-0">{{ nofo.title }}</h1>
      <div class="nofo--title-page--title--subheading">
        <span>Opportunity number: {{ nofo.number }}</span>
      </div>
    </div>
    <div class="nofo--title-page--footer clearfix">
      <div class="nofo--title-page--footer--logo">
        <img alt="Heath and Human Services logo" src="https://bn-ptzepiewjq-uc.a.run.app/static/img/hhs-logo.svg" />
      </div>
      <div class="nofo--title-page--footer--subheading">
        <span>Notice of Funding Opportunity</span>
        <span>Application due April 5, 2024</span>
      </div>
      <div class="nofo--title-page--footer--image">
        <img alt="Two doctors conversing" src="https://bn-ptzepiewjq-uc.a.run.app/static/img/title-pic.jpg" />
      </div>
    </div>
  </section>
  {% for section in nofo.sections.all %}
    <section id="{{ section.html_id }}" class="section section--{{ forloop.counter }} section--{{ section.html_id }}">
      <!-- SECTION TITLE PAGE -->
      <div class="title-page section--title-page">
        <div class="header-nav section--title-page--header-nav">
          <p>Jump to a step</p>
          <ol>
            <li><a href="#{{ nofo.sections.all.0.html_id }}" {% if nofo.sections.all.0.html_id == section.html_id %}aria-current="step"{% endif %}>Review</a></li>
            <li><a href="#{{ nofo.sections.all.1.html_id }}" {% if nofo.sections.all.1.html_id == section.html_id %}aria-current="step"{% endif %}>Get ready</a></li>
            <li><a href="#{{ nofo.sections.all.2.html_id }}" {% if nofo.sections.all.2.html_id == section.html_id %}aria-current="step"{% endif %}>Prepare</a></li>
            <li><a href="#{{ nofo.sections.all.3.html_id }}" {% if nofo.sections.all.3.html_id == section.html_id %}aria-current="step"{% endif %}>Learn</a></li>
            <li><a href="#{{ nofo.sections.all.4.html_id }}" {% if nofo.sections.all.4.html_id == section.html_id %}aria-current="step"{% endif %}>Submit</a></li>
            <li><a href="#{{ nofo.sections.all.5.html_id }}" {% if nofo.sections.all.5.html_id == section.html_id %}aria-current="step"{% endif %}>Award</a></li>
            <li><a href="#{{ nofo.sections.all.6.html_id }}" {% if nofo.sections.all.6.html_id == section.html_id %}aria-current="step"{% endif %}>Contacts</a></li>
          </ol>
        </div>
        <div class="section--title-page--name">
          <h2 id="{{ section.html_id }}">
            {% with section.name|nofo_section_name_separator as section_name %}
              <span>Step {% if section_name.number %}{{ section_name.number }}{% else %}{{ forloop.counter }}{% endif %}:</span>
              <br />
              <span>{{ section_name.name }}</span>
            {% endwith %}
          </h2>
        </div>
        <div class="section--title-page--toc">
          <p>In this step</p>
          <ul>
            {% for subsection in section.subsections.all %}
              {% with tag=subsection.tag content=subsection.name id=subsection.html_id %}
                {% if tag == 'h3' %}
                  <li><a href="#{{ subsection.html_id }}">{{ content }}</a></li>
                {% endif %}
              {% endwith %}
            {% endfor %}
          </ul>
        </div>
      </div>

      <!-- RUNNING HEADER -->
      <!-- after first section title page -->
      <div class="header-nav header-nav--running-header">
        <ol>
          <li><a href="#{{ nofo.sections.all.0.html_id }}" {% if nofo.sections.all.0.html_id == section.html_id %}aria-current="step"{% endif %}>Review</a></li>
          <li><a href="#{{ nofo.sections.all.1.html_id }}" {% if nofo.sections.all.1.html_id == section.html_id %}aria-current="step"{% endif %}>Get ready</a></li>
          <li><a href="#{{ nofo.sections.all.2.html_id }}" {% if nofo.sections.all.2.html_id == section.html_id %}aria-current="step"{% endif %}>Prepare</a></li>
          <li><a href="#{{ nofo.sections.all.3.html_id }}" {% if nofo.sections.all.3.html_id == section.html_id %}aria-current="step"{% endif %}>Learn</a></li>
          <li><a href="#{{ nofo.sections.all.4.html_id }}" {% if nofo.sections.all.4.html_id == section.html_id %}aria-current="step"{% endif %}>Submit</a></li>
          <li><a href="#{{ nofo.sections.all.5.html_id }}" {% if nofo.sections.all.5.html_id == section.html_id %}aria-current="step"{% endif %}>Award</a></li>
          <li><a href="#{{ nofo.sections.all.6.html_id }}" {% if nofo.sections.all.6.html_id == section.html_id %}aria-current="step"{% endif %}>Contacts</a></li>
        </ol>
      </div>

      <!-- SECTION CONTENT -->
      <div class="section--content">
        {% for subsection in section.subsections.all %}
          {% with tag=subsection.tag content=subsection.name id=subsection.html_id %}
            {% include "includes/heading.html" with tag=tag content=content id=id only %}
          {% endwith %}
          {{ subsection.body|safe_markdown|add_captions_to_tables }}
        {% endfor %}
      </div>
    </section>
  {% endfor %}
{% endblock %}
