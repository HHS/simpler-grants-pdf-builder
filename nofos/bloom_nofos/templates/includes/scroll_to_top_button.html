{% comment %}
Scroll-to-top button macro

This macro adds a floating "scroll to top" button that appears when the user
has scrolled down the page. The button is hidden by default and shows with
a smooth fade-in animation once the user scrolls past 90% of the viewport height.

Usage in base.html (context variable approach):
  In your view, set: context['include_scroll_to_top'] = True
  The macro is automatically included via base.html based on the variable.

Direct usage (for overrides):
  {% include "includes/scroll_to_top_button.html" with use_scroll_to_top=True %}

The button visibility is controlled by JavaScript that tracks the scroll position.
Clicking scrolls smoothly to the top and moves focus to #main-content for a11y.
{% endcomment %}

<div class="back-to-top--container" role="doc-backlink">
  <a href="#main-content" aria-label="Back to top of page" class="usa-button--icon usa-button--icon--before usa-button--arrow_upward">
    <span class="margin-left-05">Top</span>
  </a>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
  const btn = document.querySelector(".back-to-top--container a");

  if (!btn) return;

  // Show button after scrolling past 90% of viewport height
  const triggerHeight = window.innerHeight * 0.9;

  const handleScroll = () => {
    if (window.scrollY > triggerHeight) {
      btn.classList.add("is-visible");
    } else {
      btn.classList.remove("is-visible");
    }
  };

  // Use passive listener for better scroll performance
  window.addEventListener("scroll", handleScroll, { passive: true });

  // Smooth scroll to top when clicked
  btn.addEventListener("click", function (e) {
    e.preventDefault();
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  });
});
</script>
