{% extends 'base.html' %}
{% load tz %}

{% block title %}
  {{ document.title }} — {{ current_section.name }}</title>
{% endblock %}

{% block body_class %}composer_document_section{% endblock %}

{% block content %}
  <div class="grid-row cg-layout">
    <!-- sticky sidenav -->

    <aside class="grid-col-12 tablet:grid-col-3 cg-sidenav">
      <div class="back-link font-body-md margin-bottom-105">
        <a class="usa-button--icon--before usa-button--arrow_back" href="{% url 'composer:composer_index' %}">Home</a>
      </div>

      <p class="side-nav-list--intro">Sections in this content guide</p>

      <nav id="side-nav" aria-label="Section navigation">
        <ul id="side-nav-list" class="usa-sidenav">
          {% for section in sections %}
            <li class="usa-sidenav__item">
              <a
                href="{% url 'composer:composer_document_section' document.pk section.pk %}"
                {% if section.id == current_section.id %}aria-current="page" class="usa-current"{% endif %}>
                {{ section.name }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </nav>
    </aside>

    <!-- current_section content -->
    <main class="grid-col-12 tablet:grid-col-9">
      <div class="subhead--document-name font-sans-md text-base">{{ document.title }}</div>
      <h1 class="margin-bottom-1 margin-top-1 font-serif-xl">{{ current_section.name }}</h1>
      {% timezone "America/New_York" %}
        <p>
          <em>Last updated on <strong>{{ document.updated|date:'F j' }} at {{ document.updated|date:'g:i A' }}</strong></em>.
        </p>
      {% endtimezone %}
      <p>
        Review and make updates to the content guide.
        Enter instructions, question and/or fields you’d want within each section of the grant application.
        By clicking “Edit,” you can set how you want writers to edit a section such as making any, all or no changes to the content.
      </p>
      <hr />

      <!-- Header blocks (h2/h3) -->
      {% for ss in header_blocks %}
        <section id="{{ ss.html_id }}" class="margin-bottom-3">
          <h3 class="margin-bottom-1">{{ ss.name }}</h3>
          <div class="margin-bottom-2">
            {# Replace with your Markdown renderer if needed #}
            {{ ss.body|safe }}
          </div>
        </section>
      {% endfor %}

      <!-- Accordion blocks (h4/h5/h6/...) -->
      {% if accordion_blocks %}
        <div class="usa-accordion">
          {% for ss in accordion_blocks %}
            <h4 class="usa-accordion__heading">
              <button class="usa-accordion__button"
                      aria-expanded="false"
                      aria-controls="acc-{{ ss.pk }}">
                {{ ss.name|default:"Details" }}
              </button>
            </h4>
            <div id="acc-{{ ss.pk }}" class="usa-accordion__content usa-prose">
              {{ ss.body|safe }}
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Pager -->
      <nav class="display-flex flex-justify margin-top-4">
        <div>
          {% if prev_sec %}
            <a class="usa-button usa-button--outline"
                href="{% url 'composer:composer_document_section' document.pk prev_sec.pk %}">
                ← {{ prev_sec.name }}
            </a>
          {% endif %}
        </div>
        <div>
          {% if next_sec %}
            <a class="usa-button"
                href="{% url 'composer:composer_document_section' document.pk next_sec.pk %}">
                {{ next_sec.name }} →
            </a>
          {% endif %}
        </div>
      </nav>
    </main>
  </div>
{% endblock %}
