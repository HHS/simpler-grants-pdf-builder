{% extends "base.html" %}
{% load static %}

{% block title %}
  Subsection: {% if subsection.name %}{{ subsection.name }}{% else %}(#{{ subsection.order }}){% endif %}
{% endblock %}

{% block css %}
  <link href="{% static 'plugins/css/bootstrap.min.css' %}" type="text/css" media="all" rel="stylesheet">
  <link href="{% static 'plugins/css/ace.min.css' %}" type="text/css" media="all" rel="stylesheet">
  <link href="{% static 'martor/css/martor.bootstrap.min.css' %}" type="text/css" media="all" rel="stylesheet">
{% endblock %}

{% block body_class %}subsection_edit subsection_edit--composer{% endblock %}

{% block content %}
    <div class="back-link font-body-md margin-bottom-105">
      <a class="usa-button--icon--before usa-button--arrow_back" href="{% url 'composer:section_view' document.pk section.pk %}#accordion-{{ subsection.pk }}">{{ section.name }}</a>
    </div>

    <h1 class="font-heading-xl margin-y-0">Select how writers edit “{{ subsection.name|default:"This subsection" }}”</h1>
    <p>Select how writers can edit this content in the guide.</p>

    <form method="post" novalidate>
      {% csrf_token %}

      {% include "includes/_optional_radios.html" with field=form.optional only %}
      {% include "includes/_edit_mode_radios.html" with field=form.edit_mode subsection_variables=subsection_variables only %}

      {# --- Body (Martor) --- #}
      <div class="margin-top-4">
        <label class="usa-label text-bold" for="{{ form.body.id_for_label }}">Section content</label>
        <p>Editor view uses Markdown to display content. Find out more about <a href="#">Markdown</a>.
        <br>
        Select “Preview” to see how content will appear.</p>

        {% if form.body.errors %}
          <div class="usa-error-message margin-bottom-1">{{ form.body.errors.0 }}</div>
        {% endif %}

        <div class="main-martor--container {% if form.body.errors %}main-martor--container--error{% endif %} {% if form.edit_mode.value == 'full' %}styled-subsection-body--full{% endif %}">
          {{ form.body }}
        </div>

      </div>

      <div class="margin-top-4">
        <button class="usa-button" type="submit">Save</button>
        <a class="usa-button usa-button--unstyled margin-left-2"
           href="{% url 'composer:section_view' document.pk section.pk %}">Cancel</a>
      </div>
    </form>

    <hr class="margin-top-3 margin-bottom-5" />

    <details class="usa-accordion usa-accordion--bordered">
      <summary class="usa-accordion__button">
        <h2 class="usa-accordion--heading">
          Other actions
        </h2>
      </summary>

      <div class="usa-accordion__content usa-prose">
        <ul class="usa-list usa-list--unstyled">
          <li>
            <a class="usa-button usa-button--green" href="{% url 'composer:subsection_create' document.pk section.pk %}?prev_subsection={{subsection.id}}">
              Add section
            </a> — add a new section after this one
          </li>
          <li>
            <a class="usa-button usa-button--secondary" href="{%url 'composer:subsection_confirm_delete' document.pk section.pk subsection.pk %}">
              Delete section
            </a> — remove this section completely
          </li>
        </ul>
      </div>
    </details>
{% endblock %}

{% block js_footer %}
  <script type="text/javascript" src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/jquery.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/bootstrap.min.js' %}"></script>

  <script type="text/javascript" src="{% static 'plugins/js/ace.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/mode-markdown.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/ext-language_tools.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/theme-github.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/typo.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/spellcheck.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/highlight.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/js/emojis.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'martor/js/martor.bootstrap.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/composer/martor-curly-variables.js' %}"></script>
{% endblock %}
