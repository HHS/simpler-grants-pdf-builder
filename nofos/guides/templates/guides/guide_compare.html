{% extends 'base.html' %}
{% load static martortags add_classes_to_tables add_footnote_ids add_captions_to_tables add_classes_to_lists add_classes_to_paragraphs convert_paragraphs_to_hrs %}

{% block title %}
  Content Guide comparison result
{% endblock %}

{% block css %}
  <link href="{% static "styles-theme-base.css" %}" type="text/css" media="all" rel="stylesheet">
  <link href="{% static "theme-orientation-portrait.css" %}" type="text/css" media="all" rel="stylesheet">
  <link href="{% static "theme-opdiv-cdc.css" %}" type="text/css" media="all" rel="stylesheet">
  <link href="{% static "theme-opdiv-cdc-blue.css" %}" type="text/css" media="all" rel="stylesheet">
{% endblock %}

{% block body_class %}nofo_compare nofo_compare--content-guide{% endblock %}

{% block content %}
  <div class="usa-alert usa-alert--warning usa-alert--slim usa-alert--no-icon usa-alert--alpha margin-bottom-3">
    <div class="usa-alert__body bg-base-lightest">
      <p class="usa-alert__text">
        <span class="usa-tag bg-gold text-ink">Beta</span>
        <span class="margin-left-1">Comparing a Content Guide to a NOFO is an experimental feature and will change as we improve it. <br />{% include "includes/feedback_link.html" %}.</span>
      </p>
    </div>
  </div>

  {% url 'guides:guide_edit' guide.id as back_href %}
  {% include "includes/page_heading.html" with title="Check out the differences" back_text="Compare a NOFO to Content Guide “"|add:guide.title|add:"”" back_href=back_href only %}

  <div class="usa-prose margin-bottom-5">
    <p>Get a breakdown of what content has changed between the current version and your newly uploaded one.</p>

    <p class="font-sans-lg"><strong>Compare overview</strong></p>
    <ul>
      <li>There are <strong>{{ num_changed_subsections }}</strong> section{{ num_changed_subsections|pluralize }} with changes.</li>
      <li><del>Red with a strikethrough</del> is a deletion</li>
      <li><ins>Green with an underline</ins> is an addition</li>
    </ul>

    <button class="usa-button">Set up compare settings</button>
  </div>

    {% if num_changed_sections == 0 %}
      <h2>No changes</h2>
      <p>
        This document (<span class="font-mono-sm">{{ new_nofo.filename }}</span>) matches your Content Guide: “{{ guide.title }}”.
      </p>

      <h3 class="margin-top-4" id="follow-up-actions">Follow-up actions</h3>
      <a href="{% url 'guides:guide_edit' guide.id %}" class="usa-button">
        Back to “{{ guide.title }}”
      </a>

    {% else %}

      {% if comparison %}
        <div class="nofo_view--wrapper">
          <div class="nofo_view--menu-bar">
            <button class="nofo_view--menu-bar--button nofo_view--menu-bar--button__content_copy">
              Side-by-side view
            </button>
            <button class="nofo_view--menu-bar--button nofo_view--menu-bar--button__upload_file">
              Single view
            </button>
            <div class="nofo_view--menu-bar--vertical-space"></div>
            <button class="nofo_view--menu-bar--button nofo_view--menu-bar--button__expand_more">
              Previous section
            </button>
            <button class="nofo_view--menu-bar--button nofo_view--menu-bar--button__expand_less">
              Next section
            </button>
          </div>
          <div class="nofo_view nofo_view--old">
            {% for section in comparison %}
              <section id="section--{{ section.html_id }}" class="section section--{{ forloop.counter }} {% if forloop.counter > 7 %}section--appendix {% endif %}section--{{ section.html_id }}{% if section.html_class %} {{ section.html_class }}{% endif %}">
                <h2 id="{{ section.html_id }}" >{{ section.name }}</h2>
                <div class="section--content">

                  {% for subsection in section.subsections %}
                    {% with tag=subsection.tag content=subsection.name id=subsection.html_id class=subsection.html_class %}
                        {% include "includes/heading.html" with tag=tag content=content id=id class=class only %}
                    {% endwith %}
                      {% if subsection.diff %}
                        {{ subsection.diff|safe|add_classes_to_tables|add_footnote_ids|add_classes_to_paragraphs|add_captions_to_tables|add_classes_to_lists|convert_paragraphs_to_hrs }}
                      {% elif subsection.new_value %}
                        {{ subsection.new_value|safe_markdown|add_classes_to_tables|add_footnote_ids|add_classes_to_paragraphs|add_captions_to_tables|add_classes_to_lists|convert_paragraphs_to_hrs }}
                      {% elif subsection.old_value %}
                        {{ subsection.old_value|safe_markdown|add_classes_to_tables|add_footnote_ids|add_classes_to_paragraphs|add_captions_to_tables|add_classes_to_lists|convert_paragraphs_to_hrs }}
                      {% endif %}
                  {% endfor %}

                </div>
              </section>
            {% endfor %}
          </div>
        </div>

      {% endif %}
    {% endif %}
{% endblock %}
